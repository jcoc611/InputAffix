// Created by Juan Camilo Osorio (JCOC611 - jcoc611.com).
// Version 0.1.1. (Beta).
// Consider giving back by sharing your own code!
// Licensed under the MIT License. 
// http://www.opensource.org/licenses/mit-license.php

// Includes jQuery Caret v1.02
// Slightly modified by JCOC611.
// Created by C. F., Wong, and also licensed
// under the MIT License. Find his project here:
// https://code.google.com/p/jcaret/ 

!function(t){if(!t)throw new Error("Input Affix: no jQuery found. Make sure window.jQuery exists.");t.fn.caret=function(t,e){var n,a,h=this[0];if("object"==typeof t&&"number"==typeof t.start&&"number"==typeof t.end)n=t.start,a=t.end;else if("number"==typeof t&&"number"==typeof e)n=t,a=e;else if("string"==typeof t)(n=h.value.indexOf(t))>-1?a=n+t.length:n=null;else if("[object RegExp]"===Object.prototype.toString.call(t)){var r=t.exec(h.value);null!=r&&(n=r.index,a=n+r[0].length)}if("undefined"!=typeof n){if(h.createTextRange){var l=h.createTextRange();l.collapse(!0),l.moveStart("character",n),l.moveEnd("character",a-n),l.select()}else h.selectionStart=n,h.selectionEnd=a;return h.focus(),this}if(document.selection){var i=document.selection;if("textarea"!=h.tagName.toLowerCase()){var s=this.val(),g=i.createRange().duplicate();g.moveEnd("character",s.length);var c=""==g.text?s.length:s.lastIndexOf(g.text);g=i.createRange().duplicate(),g.moveStart("character",-s.length);var f=g.text.length}else{var g=i.createRange(),d=g.duplicate();d.moveToElementText(h),d.setEndPoint("EndToEnd",g);var c=d.text.length-g.text.length,f=c+g.text.length}}else var c=h.selectionStart,f=h.selectionEnd;var u=h.value.substring(c,f);return{start:c,end:f,text:u,replace:function(t){return h.value.substring(0,c)+t+h.value.substring(f,h.value.length)}}},t.fn.prefix=function(e){return e?(this.data("prefix",e),0!=this.val().indexOf(e)&&this.val(e+this.val()),this.on("keypress",function(){var e=t(this).caret(),n=t(this).data("prefix");if(e.start<n.length){var a=e.end;a<n.length&&(a+=n.length),t(this).caret({start:n.length,end:a})}}).on("keydown",function(e){var n=t(this).caret(),a=t(this).data("prefix");if(8==e.which||46==e.which)8==e.which&&n.start<=a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.start==n.end?e.preventDefault():n.start<a.length&&n.end==a.length?(t(this).caret({start:a.length,end:Math.max(n.end,a.length)}),e.preventDefault()):n.start<a.length&&t(this).caret({start:a.length,end:Math.max(n.end,a.length)});else if(86==e.which&&e.ctrlKey){if(n.start<a.length){var h=n.end;h<a.length&&(h+=a.length),t(this).caret({start:a.length,end:h})}}else 36==e.which&&(t(this).caret({start:a.length,end:a.length}),e.preventDefault())}),this):this.data("prefix")},t.fn.suffix=function(e){return e?(this.data("suffix",e),-1==this.val().indexOf(e,this.val().length-e.length)&&this.val(this.val()+e),this.on("keypress",function(){var e=t(this).caret(),n=t(this).val(),a=t(this).data("suffix");if(e.end>n.length-a.length){var h=e.start;h>n.length-a.length&&(h-=a.length),t(this).caret({start:h,end:n.length-a.length})}}).on("keydown",function(e){var n=t(this).caret(),a=t(this).val(),h=t(this).data("suffix");if(8==e.which||46==e.which)46==e.which&&n.end>=a.length-h.length&&n.start==n.end?(t(this).caret({start:a.length-h.length,end:a.length-h.length}),e.preventDefault()):46==e.which&&n.end>=a.length-h.length&&n.start==n.end?e.preventDefault():n.start>a.length-h.length&&n.start==a.length-h.length?(t(this).caret({start:a.length-h.length,end:a.length-h.length}),e.preventDefault()):n.end>a.length-h.length&&t(this).caret({end:a.length-h.length,start:Math.min(n.start,a.length-h.length)});else if(86==e.which&&e.ctrlKey){if(n.end>a.length-h.length){var r=n.start;r>a.length-h.length&&(r-=h.length),t(this).caret({start:r,end:a.length-h.length})}}else 35==e.which&&(t(this).caret({start:a.length-h.length,end:a.length-h.length}),e.preventDefault())}),this):this.data("suffix")}}(jQuery);